<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player vs. Environment</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background-color: #142FA6;
            color: #333;
            line-height: 1.6;
        }

        /* Header */
        header {
            background-color: #2a9d8f;
            color: white;
            padding: 1rem;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        header h1 {
            font-size: 2rem;
        }

        nav {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        nav a {
            color: white;
            text-decoration: none;
            font-weight: bold;
        }

        nav a:hover {
            text-decoration: underline;
        }

        #wallet-connect {
            background-color: #e9c46a;
            color: #264653;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        #wallet-connect:hover {
            background-color: #f4a261;
        }

        #wallet-status {
            color: white;
            font-size: 0.9rem;
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('https://source.unsplash.com/1600x900/?knight');
            background-size: cover;
            background-position: center;
            height: 60vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
        }

        .hero h2 {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .hero p {
            font-size: 1.2rem;
            max-width: 600px;
        }

        /* Content Section */
        .content {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .content h3 {
            color: #2a9d8f;
            font-size: 2rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .image-gallery img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        /* Footer */
        footer {
            background-color: #264653;
            color: white;
            text-align: center;
            padding: 1rem;
            margin-top: 2rem;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 1rem;
            }

            header h1 {
                font-size: 1.5rem;
            }

            nav {
                flex-direction: column;
            }

            nav a {
                margin: 0.5rem 0;
            }

            .hero h2 {
                font-size: 2rem;
            }

            .hero p {
                font-size: 1rem;
                padding: 0 1rem;
            }

            .content h3 {
                font-size: 1.5rem;
            }

            #wallet-connect {
                width: 100%;
                text-align: center;
            }

            #wallet-status {
                max-width: 100%;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <h1>Player vs. Environment</h1>
        <nav>
            <a href="#home">Home</a>
            <a href="#about">About</a>
            <a href="#gallery">Gallery</a>
            <a href="#contact">Contact</a>
            <button id="wallet-connect">Connect Wallet</button>
            <span id="wallet-status">Not Connected</span>
        </nav>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <h2>Welcome to Player vs. Environment</h2>
        <p>Embark on epic adventures, conquer challenges, and embrace the journey with optimism and courage!</p>
    </section>

    <!-- Content Section -->
    <section class="content">
        <h3>Our Mission</h3>
        <p>
            At Player vs. Environment, we believe in the power of optimism to overcome any challenge. 
            Join our community of adventurers as we explore virtual worlds, battle epic foes, 
            and celebrate the thrill of the journey. Whether you're a seasoned knight or a new hero, 
            there's a place for you in our vibrant, positive community.
        </p>
        <div class="image-gallery">
            <img src="https://source.unsplash.com/600x400/?knight,armor" alt="Knight in armor">
            <img src="https://source.unsplash.com/600x400/?knight,sword" alt="Knight with sword">
            <img src="https://source.unsplash.com/600x400/?armor,medieval" alt="Medieval armor">
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <p>&copy; 2025 Player vs. Environment. All rights reserved.</p>
    </footer>

    <!-- JavaScript for MetaMask Integration -->
    <script>
        const connectButton = document.getElementById('wallet-connect');
        const walletStatus = document.getElementById('wallet-status');

        // Optimism Network Configuration
        const optimismNetwork = {
            chainId: '0xa', // Chain ID 10 in hexadecimal
            chainName: 'Optimism',
            nativeCurrency: {
                name: 'ETH',
                symbol: 'ETH',
                decimals: 18
            },
            rpcUrls: ['https://mainnet.optimism.io'],
            blockExplorerUrls: ['https://optimistic.etherscan.io']
        };

        // Check if MetaMask is installed
        async function checkMetaMask() {
            if (typeof window.ethereum === 'undefined') {
                walletStatus.textContent = 'MetaMask not installed';
                alert('Please install MetaMask to connect your wallet.');
                return false;
            }
            return true;
        }

        // Add or switch to Optimism network
        async function addOptimismNetwork() {
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: optimismNetwork.chainId }],
                });
            } catch (switchError) {
                // If the network is not added, add it
                if (switchError.code === 4902) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [optimismNetwork],
                        });
                    } catch (addError) {
                        console.error('Error adding Optimism network:', addError);
                        walletStatus.textContent = 'Failed to add Optimism';
                        alert('Failed to add Optimism network. Please try again.');
                    }
                } else {
                    console.error('Error switching to Optimism network:', switchError);
                    walletStatus.textContent = 'Connection failed';
                    alert('Failed to switch to Optimism network. Please try again.');
                }
            }
        }

        // Connect wallet and display address
        async function connectWallet() {
            if (!await checkMetaMask()) return;

            try {
                // Request account access
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });
                
                // Add or switch to Optimism network
                await addOptimismNetwork();

                // Display shortened wallet address
                const address = accounts[0];
                walletStatus.textContent = `${address.slice(0, 6)}...${address.slice(-4)}`;
                connectButton.textContent = 'Connected';
                connectButton.disabled = true;
            } catch (error) {
                console.error('Error connecting wallet:', error);
                walletStatus.textContent = 'Connection failed';
                alert('Failed to connect wallet. Please try again.');
            }
        }

        // Event listener for connect button
        connectButton.addEventListener('click', connectWallet);

        // Check if already connected on page load
        window.addEventListener('load', async () => {
            if (await checkMetaMask()) {
                try {
                    const accounts = await window.ethereum.request({
                        method: 'eth_accounts'
                    });
                    if (accounts.length > 0) {
                        // Check if already on Optimism network
                        const chainId = await window.ethereum.request({
                            method: 'eth_chainId'
                        });
                        if (chainId === optimismNetwork.chainId) {
                            walletStatus.textContent = `${accounts[0].slice(0, 6)}...${accounts[0].slice(-4)}`;
                            connectButton.textContent = 'Connected';
                            connectButton.disabled = true;
                        }
                    }
                } catch (error) {
                    console.error('Error checking wallet on load:', error);
                }
            }
        });

        // Handle account or network changes
        window.ethereum?.on('accountsChanged', (accounts) => {
            if (accounts.length > 0) {
                walletStatus.textContent = `${accounts[0].slice(0, 6)}...${accounts[0].slice(-4)}`;
                connectButton.textContent = 'Connected';
                connectButton.disabled = true;
            } else {
                walletStatus.textContent = 'Not Connected';
                connectButton.textContent = 'Connect Wallet';
                connectButton.disabled = false;
            }
        });

        window.ethereum?.on('chainChanged', (chainId) => {
            if (chainId === optimismNetwork.chainId) {
                connectButton.textContent = 'Connected';
                connectButton.disabled = true;
            } else {
                walletStatus.textContent = 'Wrong Network';
                connectButton.textContent = 'Connect Wallet';
                connectButton.disabled = false;
            }
        });
    </script>
</body>
</html>
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import "@openzeppelin/contracts/access/Ownable.sol";

contract CoinFlip is Ownable {
    IERC20 public coopToken; // COOP token contract
    uint256 public constant MIN_BET = 1 * 10**18; // 1 COOP (assuming 18 decimals)
    uint256 public constant MAX_BET = 1000 * 10**18; // 1000 COOP

    event CoinFlipped(address indexed player, uint256 betAmount, bool won, uint256 payout);

    constructor(address _coopToken) Ownable(msg.sender) {
        coopToken = IERC20(_coopToken);
    }

    // Function to flip the coin
    function flipCoin(uint256 betAmount) external {
        // Validate bet amount
        require(betAmount >= MIN_BET, "Bet must be at least 1 COOP");
        require(betAmount <= MAX_BET, "Bet must not exceed 1000 COOP");
        require(coopToken.balanceOf(msg.sender) >= betAmount, "Insufficient COOP balance");
        require(coopToken.allowance(msg.sender, address(this)) >= betAmount, "Insufficient allowance");

        // Transfer bet amount to contract
        require(coopToken.transferFrom(msg.sender, address(this), betAmount), "Token transfer failed");

        // Generate pseudo-random result (heads or tails)
        bool won = _getRandomResult();

        // Calculate payout (double the bet if won, else 0)
        uint256 payout = won ? betAmount * 2 : 0;

        // If won, transfer payout to player
        if (won) {
            require(coopToken.balanceOf(address(this)) >= payout, "Contract has insufficient funds");
            require(coopToken.transfer(msg.sender, payout), "Payout transfer failed");
        }

        emit CoinFlipped(msg.sender, betAmount, won, payout);
    }

    // Pseudo-random number generator for coin flip (50/50)
    function _getRandomResult() private view returns (bool) {
        uint256 random = uint256(
            keccak256(
                abi.encodePacked(block.timestamp, block.prevrandao, msg.sender)
            )
        );
        return (random % 2) == 0; // 0 for heads, 1 for tails
    }

    // Owner can deposit COOP tokens to fund payouts
    function depositTokens(uint256 amount) external onlyOwner {
        require(coopToken.transferFrom(msg.sender, address(this), amount), "Deposit failed");
    }

    // Owner can withdraw COOP tokens (emergency use)
    function withdrawTokens(uint256 amount) external onlyOwner {
        require(coopToken.transfer(msg.sender, amount), "Withdrawal failed");
    }

    // Get contract's COOP balance
    function getContractBalance() external view returns (uint256) {
        return coopToken.balanceOf(address(this));
    }

}

